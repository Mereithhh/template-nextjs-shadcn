# Platform Admin - 前端开发规范

这是一个基于 Next.js 14 (App Router) + shadcn/ui 的管理后台项目。

## 技术栈

- **框架**: Next.js 14 (App Router)
- **UI 组件库**: shadcn/ui (new-york 风格)
- **样式方案**: Tailwind CSS
- **图标库**: lucide-react
- **语言**: TypeScript

## MCP
你可以使用 shadcn-mcp 来获取一些 block 复用。

## 核心原则

请你在开发过程中，先考虑复用的问题和代码结构，不要重复造轮子。

**当你执行完任务，不要写总结文档或者配置指南，除非是用户要求。**

## 前端开发规范

### 1. 错误处理与用户反馈

- ✅ **所有 API 请求必须使用 `try-catch` 包裹**
- ✅ **通过 HTTP 拦截器统一处理 401 错误，登录失效时自动跳转登录页**
- ✅ **任何请求或异步操作都要有 loading 状态**
- ✅ **任何操作（成功/失败）都要有 toast 提示**

**Toast 使用规范**：
- 使用项目已集成的 toast 组件（当前使用 `@/hooks/use-toast`）
- 成功操作：显示绿色成功提示
- 失败操作：显示红色错误提示，并包含具体错误信息
- 警告提示：使用黄色警告样式

### 2. 用户交互安全

- ✅ **关键的删除操作必须有二次弹窗确认**
  - 使用 shadcn/ui 的 `AlertDialog` 组件
  - 确认按钮使用红色危险样式
  - 弹窗中明确说明删除的后果

### 3. 代码复用与抽象

- ✅ **可能需要多次使用的代码必须抽象成组件**
- ✅ **常用的逻辑抽象成自定义 Hooks（放在 `/hooks` 目录）**
- ✅ **尽量使用 shadcn/ui 组件，避免重复实现复杂逻辑**
- ✅ **复用组件放在 `/components` 目录，页面专属组件放在页面同级目录**

### 4. 状态管理

- ✅ **使用 React 内置 Hooks（`useState`, `useReducer`）管理组件状态**
- ✅ **如需全局状态管理，考虑引入 Zustand**
- ✅ **表单状态推荐使用 React Hook Form**
- ✅ **服务端数据推荐使用 React Query / SWR 管理**

### 5. 表格与分页

- ✅ **所有表格必须有分页功能，支持改变分页大小**（如 10/20/50/100 条/页）
- ✅ **如果后端接口支持，要实现筛选和排序**
- ✅ **切换页面时不要让 UI 闪动**（保持高度稳定，考虑骨架屏或占位）
- ✅ **表格必须设置合适的最小高度**（`min-h-[400px]`）
- ✅ **表格数据为空时显示友好提示**
- ✅ **表格 loading 时使用 Skeleton 占位**

### 6. 滚动与布局

- ✅ **尽量使用浏览器原生的 `scroll`，而不是组件自带的滚动容器**
  - 原因：原生滚动性能更好，体验更流畅
- ✅ **避免嵌套滚动容器**
- ✅ **固定头部/侧边栏时使用 `sticky` 定位**

### 7. 响应式设计

- ✅ **注意移动端和平板上的体验**
- ✅ **所有页面都要支持响应式布局**
- ✅ **使用 Tailwind CSS 的响应式前缀**（`sm:`, `md:`, `lg:`, `xl:`, `2xl:`）
- ✅ **移动端要考虑触摸操作的便利性**（按钮至少 44x44px）

### 8. 主题支持

- ✅ **开发时必须考虑暗色模式**
- ✅ **推荐使用 `next-themes` 实现主题切换**
- ✅ **使用 Tailwind 的 `dark:` 前缀适配暗色模式**
- ✅ **所有颜色使用 CSS 变量**（shadcn/ui 已配置好）
- ❌ **避免硬编码颜色值**

### 9. Dialog 和 Sheet 尺寸规范

- ✅ **所有 Dialog 必须设置合适的宽度，避免内容挤压**
  - 简单表单：`sm:max-w-[425px]`
  - 标准表单：`sm:max-w-[600px]`
  - 带代码/长文本：`sm:max-w-[700px]`
  - 详情展示：`max-w-3xl`
- ✅ **Sheet 组件必须设置合适的高度**（`max-h-[80vh]` 或 `max-h-[90vh]`）
- ✅ **弹窗内容较多时要支持滚动**

### 10. 数据刷新功能

- ✅ **所有数据获取的页面都必须有刷新按钮**
- ✅ **刷新按钮应放在页面头部右侧**
- ✅ **刷新时显示 loading 状态**（旋转动画）
- ✅ **使用 `RefreshCw` 图标（来自 lucide-react）**

### 11. 图标和视觉元素

- ✅ **合理使用图标提升视觉效果和用户体验**（使用 `lucide-react`）
- ✅ **使用 Badge 组件展示状态和分类**
  - 成功状态：绿色
  - 警告状态：黄色
  - 错误状态：红色
  - 默认/信息：蓝色或灰色
- ✅ **图标应与文字搭配使用，增强可读性**
- ✅ **统一图标尺寸**（通常使用 `h-4 w-4` 或 `h-5 w-5`）

### 12. 国际化（i18n）【推荐】

如果项目需要支持多语言：

- ✅ **推荐使用 `next-intl` 库和 `useTranslations` Hook**
- ✅ **默认语言为英文（`en`），支持中文（`zh`）**
- ✅ **所有用户可见的文本都要使用 `t('key')` 形式**
- ✅ **翻译 keys 要有清晰的命名空间**（如 `page.section.label`）
- ✅ **翻译文件位置：`messages/en.json` 和 `messages/zh.json`**
- ❌ **禁止硬编码任何用户可见的文本**

### 13. 时间日期处理【推荐】

- ✅ **推荐使用 Day.js 处理时间日期**
- ✅ **格式化前检查有效性**：`if (!dayjs(date).isValid()) return '-'`
- ✅ **标准格式**：
  - 完整时间：`YYYY-MM-DD HH:mm:ss`
  - 日期：`YYYY-MM-DD`
  - 时间：`HH:mm:ss`
- ❌ **避免使用 `new Date().toLocaleString()`**（格式不统一）

### 14. 表单开发规范

- ✅ **推荐使用 React Hook Form 管理表单**
- ✅ **所有表单字段都要有验证规则**
- ✅ **表单提交时要禁用提交按钮，显示 loading 状态**
- ✅ **表单错误要实时显示在对应字段下方**
- ✅ **必填字段要有明确的标识**（红色星号或文字说明）

### 15. 性能优化

- ✅ **大列表使用虚拟滚动（react-virtual）**
- ✅ **合理使用 `React.memo` 避免不必要的重渲染**
- ✅ **图片使用 Next.js 的 `Image` 组件**
- ✅ **路由使用 Next.js 的 `Link` 组件实现预加载**
- ✅ **大型组件考虑使用 `dynamic` 实现代码分割**

### 16. 代码风格

- ✅ **使用 TypeScript，避免使用 `any` 类型**
- ✅ **组件 Props 必须定义类型**
- ✅ **使用函数式组件和 Hooks**
- ✅ **遵循 ESLint 规则**
- ✅ **使用有意义的变量名和函数名**
- ✅ **复杂逻辑添加注释说明**

## 代码检查清单

在提交代码前，确保：

### 功能完整性
- [ ] 所有 API 请求都有 `try-catch` 处理
- [ ] 所有操作都有 loading 状态
- [ ] 所有操作都有 toast 提示（成功/失败）
- [ ] 删除操作有二次确认弹窗
- [ ] 所有数据获取页面都有刷新按钮

### 表格规范
- [ ] 表格有分页功能
- [ ] 表格切换页面时无闪动
- [ ] 表格设置了合适的最小高度
- [ ] 表格空状态有友好提示
- [ ] 表格 loading 状态使用 Skeleton

### UI/UX 规范
- [ ] Dialog 和 Sheet 设置了合适的宽度/高度
- [ ] 合理使用图标提升视觉效果
- [ ] 使用 Badge 展示状态和分类
- [ ] 响应式布局适配移动端和平板
- [ ] 暗色模式显示正常
- [ ] 使用原生滚动而非组件滚动

### 代码质量
- [ ] 可复用的逻辑已抽象成 Hooks
- [ ] 可复用的 UI 已抽象成组件
- [ ] 尽量使用 shadcn/ui 组件
- [ ] TypeScript 类型定义完整
- [ ] 没有 ESLint 错误或警告

### 表单规范
- [ ] 使用 React Hook Form（如适用）
- [ ] 所有字段有验证规则
- [ ] 提交时有 loading 状态
- [ ] 错误信息实时显示

### 性能优化
- [ ] 图片使用 Next.js Image 组件
- [ ] 路由使用 Next.js Link 组件
- [ ] 大列表考虑虚拟滚动
- [ ] 合理使用 React.memo

## 文件组织规范

```
/app                    # Next.js App Router 页面
  /[page-name]         # 页面目录
    /components        # 页面专属组件
    page.tsx           # 页面主文件
    layout.tsx         # 布局文件（如需要）
    loading.tsx        # 加载状态（如需要）
    error.tsx          # 错误处理（如需要）

/components            # 全局共享组件
  /ui                  # shadcn/ui 组件
  /[component-name]    # 自定义组件
    index.tsx
    [component-name].tsx

/hooks                 # 自定义 Hooks
  use-[hook-name].ts

/lib                   # 工具函数和配置
  utils.ts             # 通用工具函数
  api.ts               # API 请求封装（如需要）
  constants.ts         # 常量定义（如需要）

/types                 # TypeScript 类型定义（如需要）
  index.ts
```

## 常用命令

- `pnpm dev` - 启动开发服务器
- `pnpm build` - 构建生产版本
- `pnpm start` - 启动生产服务器
- `pnpm lint` - 运行 ESLint 检查

## 注意事项

1. **不要过度设计**：先实现功能，再考虑优化
2. **保持一致性**：遵循项目现有的代码风格和组织结构
3. **测试体验**：开发完成后在不同屏幕尺寸和主题下测试
4. **性能优先**：注意首屏加载速度和交互响应速度
5. **用户体验**：站在用户角度思考交互流程是否合理

## 开发流程建议

1. **理解需求** - 明确要实现的功能和交互
2. **设计组件** - 规划组件结构，识别可复用部分
3. **实现功能** - 按照规范编写代码
4. **自测验证** - 对照检查清单验证实现
5. **优化改进** - 根据反馈优化代码和体验

---

**记住：代码是写给人看的，顺便让机器执行。保持代码简洁、可读、可维护。**

